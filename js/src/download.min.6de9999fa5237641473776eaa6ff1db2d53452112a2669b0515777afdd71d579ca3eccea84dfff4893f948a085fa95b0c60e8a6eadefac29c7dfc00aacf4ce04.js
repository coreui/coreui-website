const form=document.getElementById("form");let supportActive,supportLevel;const createAlert=(e,t,n)=>{Array.from(e.getElementsByClassName("alert")).forEach(e=>e.remove());const s=document.createElement("div");s.classList.add("alert",`alert-${t}`),s.innerHTML=n,e.appendChild(s)},download=(e,t,n)=>{const s=new XMLHttpRequest;s.open("POST","https://api.coreui.io/downloads/download.php",!0),s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.responseType="blob",s.onload=()=>{if(s.readyState===4&&s.status===200){let e="";const t=s.getResponseHeader("Content-Disposition");if(t&&t.indexOf("attachment")!==-1){const s=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/,n=s.exec(t);n!=null&&n[1]&&(e=n[1].replace(/['"]/g,""))}const o=s.getResponseHeader("Content-Type"),n=new Blob([s.response],{type:o});if(typeof window.navigator.msSaveBlob!="undefined")window.navigator.msSaveBlob(n,e);else{const s=window.URL||window.webkitURL,t=s.createObjectURL(n);if(e){const n=document.createElement("a");typeof n.download=="undefined"?window.location=t:(n.href=t,n.download=e,document.body.appendChild(n),n.click())}else window.location=t;setTimeout(function(){s.revokeObjectURL(t)},100)}}},s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.send(JSON.stringify({product:e,name:t,version:n}))},createTable=(e,t)=>{e.innerHTML="",t.forEach(t=>{const s=document.createElement("tr"),n=document.createElement("td");n.colSpan=4,n.innerHTML=t.Folder,n.classList.add("table-light","font-weight-bold"),s.appendChild(n),e.appendChild(s),t.Files.forEach(n=>{const o=document.createElement("tr"),{Downloadable:i,Archive:r,...c}=n;for(const[n,t]of Object.entries(c)){const e=document.createElement("td");e.appendChild(document.createTextNode(t)),o.appendChild(e)}const s=document.createElement("button");s.innerHTML=i?"download":"unavailable",i?(s.classList.add("btn","btn-sm","btn-coreui","btn-download"),s.dataset.product=r?`${t.Folder}/archive`:t.Folder,s.dataset.name=n.Name,s.dataset.version=`v${n.Version}`,s.addEventListener("click",e=>{download(e.target.dataset.product,e.target.dataset.name,e.target.dataset.version)})):(s.classList.add("btn","btn-sm","btn-coreui","btn-tooltip"),s.disabled=!0,s.dataset.toggle="tooltip",s.dataset.placement="top",s.title="Your subscrption expired before realease of this version.");const a=document.createElement("td");a.appendChild(s),o.appendChild(a),e.appendChild(o)})})},checkLicense=(e,t)=>{if(t.length>1){const n=new XMLHttpRequest;n.open("POST","https://api.coreui.io/downloads/get_list_of_files_for_expired.php",!0),n.onreadystatechange=()=>{if(n.readyState===4&&n.status===200){const o=JSON.parse(n.responseText),s=o.Transactions.pop();if(s)if(parseInt(s.PaymentProvider)===1||parseInt(s.PaymentProvider)===0)form.innerHTML=`Please use the following link to download your order - <a href="https://gumroad.com/purchases/${s.PurchaseID}/receipt">Download</a>`;else{const t=document.querySelector("#table-current > tbody");createTable(t,s.Download);const n=document.querySelector("#table-available > tbody");createTable(n,s.Available);const o=document.querySelector("#table-previous > tbody");createTable(o,s.Archive);const i=document.querySelector("#current"),a=document.querySelector("#current-version"),e=document.querySelector("#latest-available"),r=document.querySelector("#latest-available-version");if(s.Valid)i.classList.add("active","show"),a.classList.add("active"),e.remove(),r.remove();else{const t=document.createElement("div");t.classList.add("alert","alert-danger","my-3"),t.innerHTML="Your license was delivered with 12 months of free updates, but your subscription for free updates has expired. You can keep using the latest version available during your subscription, forever. If you need access to the latest version you have to purchase the product again.",e.insertBefore(t,e.firstChild)}const c=document.querySelector("#downloads-tab"),l=document.querySelector("#downloads-tab-content");c.classList.remove("d-none"),l.classList.remove("d-none"),form.innerHTML="";const d=[].slice.call(document.querySelectorAll('[data-toggle="tooltip"]'));d.forEach(e=>new coreui.Tooltip(e))}else{const s={email:e,license:t},n=new XMLHttpRequest;n.open("POST","https://api.coreui.io/helpscout/expired.php",!0),n.setRequestHeader("Content-type","application/json"),n.send(JSON.stringify(s)),createAlert(form,"danger","Your license has expired.")}}else createAlert(form,"danger","The license number or email address is invalid.")},n.send(JSON.stringify({email:e,license:t}))}else createAlert(form,"danger","The license number is invalid.")};form.onsubmit=e=>{e.preventDefault(),e.stopPropagation();const t=e.currentTarget,n=t.elements;if(t[0].checkValidity()===!1)t.classList.add("was-validated");else{const e=n.email.value,t=n.license.value;checkLicense(e,t)}}